<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Max Kirkby</title>
    <style>
        :root {
            --background-color: rgb(255, 252, 240);
            --text-color: rgb(16, 15, 15);
            --link-color: rgb(32, 94, 166);
            --nav-color: #666666;
            --nav-hover-color: rgb(32, 94, 166);
        }
        
        [data-theme="dark"] {
            --background-color: #1f2022;
            --text-color: #e0e0e0;
            --link-color: rgb(94, 151, 218);
            --nav-color: #a0a0a0;
            --nav-hover-color: rgb(94, 151, 218);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 60px;
        }
        
        nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        nav a {
            color: var(--nav-color);
            text-decoration: none;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }
        
        nav a:hover {
            color: var(--nav-hover-color);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        p {
            margin-bottom: 1.2rem;
            font-size: 1.1rem;
        }
        
        a {
            color: var(--link-color);
            text-decoration: none;
            transition: opacity 0.2s ease;
        }
        
        a:hover {
            opacity: 0.8;
        }
        
        .external-link::after {
            content: "↗";
            display: inline-block;
            margin-left: 3px;
        }
        
        ol {
            padding-left: 2rem;
        }
        
        li {
            margin-bottom: 0.8rem;
        }
        
        /* Simplified toggle switch styling */
        .theme-toggle-wrapper {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 28px;
            margin-left: 10px;
        }
        
        .theme-toggle {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e0e0e0;
            transition: .4s;
            border-radius: 28px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        /* Dark mode */
        .theme-toggle:checked + .toggle-slider {
            background-color: #3a3a3a;
        }
        
        .theme-toggle:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .site-title {
            font-weight: 500;
            font-size: 1.1rem;
        }
        
        .name-highlight {
            color: rgb(102, 128, 11);
            cursor: pointer;
            position: relative;
            display: inline-block;
        }
        
        .hover-photo {
            position: absolute;
            width: 105px;
            height: 105px;
            border-radius: 50%;
            overflow: hidden;
            top: -135px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 10;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .hover-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .name-highlight:hover > .hover-photo,
        .name-highlight > .hover-photo:hover {
            opacity: 1;
            pointer-events: auto;
        }
        
        .site-title a {
            text-decoration: none;
        }
        
        .projects {
            color: #4a7a9d;
        }
        
        .content-wrapper {
            margin-top: 40px;
        }
        
        .profile-photo {
            display: none;
        }
        
        .bio-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .bio-content h2 {
            margin-top: 0;
        }
        
        footer {
            margin-top: 40px;
            padding: 0;
        }
        
        .social-links {
            display: flex;
            justify-content: flex-start;
            gap: 20px;
            margin-top: 20px;
            padding-left: 0;
        }
        
        .social-link {
            color: var(--link-color);
            text-decoration: none;
            font-size: 1.1rem;
            transition: opacity 0.2s ease;
        }
        
        .social-link:hover {
            opacity: 0.8;
        }
        
        /* Puzzle Styles */
        .email-puzzle {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid var(--nav-color);
            border-radius: 8px;
            background-color: var(--background-color); /* Match body background */
            text-align: center; /* Center align content like instructions/feedback */
        }

        .puzzle-instructions {
            margin-bottom: 10px; /* Reduce margin */
            font-size: 1rem;
        }
        
        /* New SVG Graph Styles */
        #graph {
            width: 100%;
            max-width: 400px; /* Limit max size */
            height: auto;
            margin-bottom: 10px; /* Reduce margin */
            display: block; /* Prevents extra space below */
            margin-left: auto;
            margin-right: auto;
        }

        .node circle {
            fill: var(--background-color);
            stroke: var(--nav-color);
            stroke-width: 2px;
            transition: fill 0.3s ease, stroke 0.3s ease;
            cursor: pointer;
        }
        
        .node text {
            fill: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 14px;
            font-weight: bold;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none; /* Text shouldn't capture clicks */
            transition: fill 0.3s ease;
        }

        .node:hover circle {
             stroke: var(--nav-hover-color);
        }
        
        .node.selected circle {
            fill: var(--nav-hover-color);
            stroke: var(--nav-hover-color);
        }

         .node.selected text {
            fill: var(--background-color);
        }

        .edge {
            stroke: var(--nav-color);
            stroke-width: 2px;
            transition: stroke 0.3s ease;
        }
        
        .edge.selected {
            stroke: var(--nav-hover-color);
            stroke-width: 3px; /* Make selected edges slightly thicker */
        }

        .edge-label {
            fill: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 12px;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
             transition: fill 0.3s ease;
        }

        .puzzle-feedback {
            min-height: 20px; /* Reserve space */
            font-size: 0.9rem;
            text-align: center;
            color: var(--link-color);
            /* Make it live region for screen readers */
            /* Attributes will be set in JS */
        }
        
        .revealed-email {
             font-size: 1rem;
             font-family: monospace; /* Optional: make it look code-like */
             color: var(--link-color);
             text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <div class="site-title">
            <span>Max Kirkby</span>
        </div>
        <nav>
            <a href="#" class="active">me</a>
            <a href="research.html">research</a>
            <a href="#">writing</a>
            <label class="theme-toggle-wrapper">
                <input type="checkbox" class="theme-toggle">
                <span class="toggle-slider"></span>
            </label>
        </nav>
    </header>

    <main>        
        <div class="bio-content">
            <h2>me</h2>
            <p>Hi, I'm <span class="name-highlight">Max Kirkby<span class="hover-photo"><img src="images/personalweb.jpg" alt="Max Kirkby"></span></span>. I'm a <a href="https://www.rhodeshouse.ox.ac.uk/scholar-community/rhodes-scholar-bios/rhodes-scholars-class-of-2023/max-kirkby/">Rhodes Scholar</a> at Oxford, studying for a PhD in Computational Neuroscience. I'm originally from Adelaide, South Australia.</p>
            
            <p>
                My research tries to understand the neural representations of hierarchical planning and the subgoals within these plans. I work with <a href="https://www.psy.ox.ac.uk/research/cognitive-circuits">Thomas Akam</a> at Oxford and <a href="https://www.sainsburywellcome.org/web/groups/behrens-lab">Tim Behrens</a> at the Sainsbury Wellcome Centre in London. I'll first present this work at <a href="https://rldm.org/">RLDM 2025</a> in Dublin. 
            </p>

            <p>Outside of research, I co-founded <a href="https://rake.news/">Rake News</a>,
                a P2P news platform using LLMs for information debiasing. Rake evolved 
                to provide enterprise-grade RAG to organisations in Australia and the US. 
                I recently co-founded <a href="https://parsed.com/">Parsed</a>, a startup that uses mechanistic interpretability to build safer and more performant medical AI.          
            </p>

            <p>
                In a past life I was a <a href="https://tuckwell.anu.edu.au/about/scholarship">Tuckwell Scholar</a> at the ANU, where I completed a Bachelor of Philosophy (Science) in biology, neuroscience and mathematics. 
                My undergraduate included research across <a href="https://www.cell.com/trends/biochemical-sciences/fulltext/S0968-0004(23)00165-2">innate immunology</a>, 
                <a href="https://www.frontiersin.org/journals/physiology/articles/10.3389/fphys.2023.1116898/full">neurodegeneration</a> and 
                <a href="https://www.mdpi.com/2075-4418/14/22/2590">cardiology</a> at the University of Sydney, ANU, and the Walter and Eliza Hall Institute.
            </p>

            <!-- Replace Email Puzzle Section -->
            <div class="email-puzzle" id="emailPuzzleContainer">
                 <p class="puzzle-instructions">
                    Find the minimum-cost path from <strong>S</strong> to <strong>T</strong>. Click the nodes in sequence.
                 </p>
                 <svg id="graph" viewBox="0 0 400 300" role="application" aria-label="Shortest path puzzle graph. Start at S, end at T."></svg>
                 <div id="puzzleFeedback" class="puzzle-feedback" aria-live="polite"></div>
            </div>

            <div class="social-links">
                <a href="https://www.linkedin.com/in/max-kirkby15/" class="social-link">LinkedIn</a>
                <a href="https://github.com/MaxKirkby5" class="social-link">GitHub</a>
                <a href="https://x.com/kirkby_max" class="social-link">Twitter/X</a>
                <a href="https://scholar.google.com/citations?user=SoMPEoIAAAAJ&hl=en" class="social-link">Google Scholar</a>
            </div>
        </div>
    </main>

    <script>
        const themeToggle = document.querySelector('.theme-toggle');
        
        function setTheme(isDark) {
            if (isDark) {
                document.body.setAttribute('data-theme', 'dark');
                themeToggle.checked = true;
            } else {
                document.body.removeAttribute('data-theme');
                themeToggle.checked = false;
            }
            localStorage.setItem('darkMode', isDark ? 'true' : 'false');
        }
        
        const savedDarkMode = localStorage.getItem('darkMode') === 'true';
        
        setTheme(savedDarkMode);
        
        themeToggle.addEventListener('change', () => {
            setTheme(themeToggle.checked);
        });
        
        // --- New Shortest Path Puzzle Logic ---
        const svgNS = "http://www.w3.org/2000/svg";
        const graphSvg = document.getElementById('graph');
        const feedbackEl = document.getElementById('puzzleFeedback');
        const puzzleContainerEl = document.getElementById('emailPuzzleContainer'); // Get container for reveal

        const graphData = {
            nodes: {
                S: { x: 50, y: 150, label: "S" },
                A: { x: 150, y: 50, label: "A" },
                B: { x: 150, y: 250, label: "B" },
                C: { x: 250, y: 50, label: "C" },
                D: { x: 250, y: 250, label: "D" },
                T: { x: 350, y: 150, label: "T" }
            },
            edges: [
                { from: 'S', to: 'A', weight: 2 },
                { from: 'S', to: 'B', weight: 5 },
                { from: 'S', to: 'D', weight: 6 }, // Updated weight
                { from: 'A', to: 'C', weight: 2 },
                { from: 'B', to: 'D', weight: 1 },
                { from: 'C', to: 'T', weight: 3 },
                { from: 'D', to: 'T', weight: 2 }
            ],
            // Adjacency list for easier lookup during interaction
            adjacency: {
                S: { A: 2, B: 5, D: 6 },
                A: { S: 2, C: 2 },
                B: { S: 5, D: 1 },
                C: { A: 2, T: 3 },
                D: { S: 6, B: 1, T: 2 }, // Include S for completeness, T included
                T: { C: 3, D: 2 }       // T is endpoint, technically no outgoing needed for puzzle
            },
            minCost: 7,
            startNode: 'S',
            endNode: 'T'
        };

        let userPath = [graphData.startNode];
        let runningCost = 0;
        let elements = { nodes: {}, edges: {} }; // Store SVG elements

        function drawGraph() {
            graphSvg.innerHTML = ''; // Clear previous graph if any
            elements = { nodes: {}, edges: {} }; // Reset elements store
            userPath = [graphData.startNode];
            runningCost = 0;

            // Draw Edges (draw first so they are behind nodes)
            graphData.edges.forEach(edge => {
                const n1 = graphData.nodes[edge.from];
                const n2 = graphData.nodes[edge.to];
                
                const line = document.createElementNS(svgNS, 'line');
                line.setAttribute('x1', n1.x);
                line.setAttribute('y1', n1.y);
                line.setAttribute('x2', n2.x);
                line.setAttribute('y2', n2.y);
                line.classList.add('edge');
                // Store edge elements keyed by node pairs (e.g., 'S-A' and 'A-S')
                const edgeKey1 = `${edge.from}-${edge.to}`;
                const edgeKey2 = `${edge.to}-${edge.from}`;
                elements.edges[edgeKey1] = line;
                elements.edges[edgeKey2] = line; 
                graphSvg.appendChild(line);

                // Add Edge Label (Weight)
                const midX = (n1.x + n2.x) / 2;
                const midY = (n1.y + n2.y) / 2;
                 // Calculate offset perpendicular to the line
                const angle = Math.atan2(n2.y - n1.y, n2.x - n1.x);
                const offsetX = Math.sin(angle) * 10; // Adjust offset distance (10)
                const offsetY = -Math.cos(angle) * 10;

                const label = document.createElementNS(svgNS, 'text');
                label.setAttribute('x', midX + offsetX);
                label.setAttribute('y', midY + offsetY);
                label.classList.add('edge-label');
                label.textContent = edge.weight;
                graphSvg.appendChild(label);
            });
            
             // Draw Nodes
            Object.entries(graphData.nodes).forEach(([id, node]) => {
                const g = document.createElementNS(svgNS, 'g');
                g.classList.add('node');
                g.setAttribute('id', `svg-node-${id}`);
                g.setAttribute('role', 'button');
                g.setAttribute('tabindex', '0');
                
                // Build aria-label
                let ariaLabel = `Node ${id}.`;
                if (graphData.adjacency[id]) {
                     ariaLabel += " Connects to: ";
                     ariaLabel += Object.entries(graphData.adjacency[id])
                                      .map(([neighbor, weight]) => `${neighbor} (cost ${weight})`)
                                      .join(', ');
                }
                 g.setAttribute('aria-label', ariaLabel);


                const circle = document.createElementNS(svgNS, 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', 15); // Node radius
                g.appendChild(circle);

                const text = document.createElementNS(svgNS, 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y);
                text.textContent = node.label;
                g.appendChild(text);

                elements.nodes[id] = g; // Store the group element
                
                g.addEventListener('click', () => onNodeClick(id));
                g.addEventListener('keydown', (event) => {
                     if (event.key === 'Enter' || event.key === ' ') {
                         onNodeClick(id);
                     }
                 });

                graphSvg.appendChild(g);
            });
            
             // Highlight start node initially
            highlightNode(graphData.startNode);
            updateFeedback(); // Initial feedback
        }

        function highlightNode(nodeId) {
            if (elements.nodes[nodeId]) {
                elements.nodes[nodeId].classList.add('selected');
            }
        }
        
        function highlightEdge(nodeId1, nodeId2) {
             const edgeKey = `${nodeId1}-${nodeId2}`;
             if (elements.edges[edgeKey]) {
                elements.edges[edgeKey].classList.add('selected');
             }
        }

         function updateFeedback() {
            let pathStr = userPath.join(' → ');
            if (userPath.length > 1) {
                 feedbackEl.textContent = `Path: ${pathStr} (Cost: ${runningCost})`;
            } else {
                feedbackEl.textContent = 'Click the next node in the path.';
            }
         }

        function onNodeClick(nodeId) {
            const previousNode = userPath[userPath.length - 1];

            // Ignore clicks on already visited nodes or non-adjacent nodes
            if (userPath.includes(nodeId) || !graphData.adjacency[previousNode]?.[nodeId]) {
                // Maybe add subtle feedback for invalid clicks? (Optional)
                return; 
            }
            
            const cost = graphData.adjacency[previousNode][nodeId];
            runningCost += cost;
            userPath.push(nodeId);
            
            highlightNode(nodeId);
            highlightEdge(previousNode, nodeId);
            updateFeedback();

            if (nodeId === graphData.endNode) {
                checkSolution();
            }
        }

        function checkSolution() {
             // Small delay for user to see the final path/cost
             setTimeout(() => {
                  if (runningCost === graphData.minCost && userPath[0] === graphData.startNode) {
                    showSuccess();
                  } else {
                    const message = `Path cost ${runningCost}. The minimum cost is ${graphData.minCost}. Try again.`;
                    showError(message);
                    setTimeout(resetPuzzle, 1500); // Longer delay for error message
                  }
             }, 300);
        }
        
        function showSuccess() {
             feedbackEl.textContent = 'Correct! Revealing email...';
              // Replace puzzle content with email
              setTimeout(() => {
                   puzzleContainerEl.innerHTML = '<p class="revealed-email">maxkirkby1 [at] gmail [dot] com</p>';
              }, 500); // Delay reveal slightly
        }

        function showError(message) {
             feedbackEl.textContent = message;
             // Could add a visual cue like shaking the container (optional)
        }

        function resetPuzzle() {
             drawGraph(); // Redrawing resets highlights, state, and feedback
        }

        // Initial draw
        drawGraph();

    </script>
</body>
</html>