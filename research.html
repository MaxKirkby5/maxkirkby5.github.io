<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Max Kirkby - Research</title>
    <link rel="icon" href="images/dithered-icon.png" type="image/png">
    <style>
        :root {
            --background-color: rgb(255, 252, 240);
            --text-color: rgb(16, 15, 15);
            --link-color: rgb(32, 94, 166);
            --nav-color: #666666;
            --nav-hover-color: rgb(32, 94, 166);
            /* Cluster palette */
            --cluster-1: rgb(175, 48, 41);
            --cluster-2: rgb(188, 82, 21);
            --cluster-3: rgb(173, 131, 1);
            --cluster-4: rgb(102, 128, 11);
            --cluster-5: rgb(36, 131, 123);
            --cluster-6: rgb(32, 94, 166);
            --cluster-7: rgb(94, 64, 157);
            --cluster-8: rgb(160, 47, 111);
        }
        
        [data-theme="dark"] {
            --background-color: #1f2022;
            --text-color: #e0e0e0;
            --link-color: rgb(94, 151, 218);
            --nav-color: #a0a0a0;
            --nav-hover-color: rgb(94, 151, 218);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 60px;
        }
        
        nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        nav a {
            color: var(--nav-color);
            text-decoration: none;
            font-size: 1.1rem;
            transition: color 0.3s ease;
        }
        
        nav a:hover {
            color: var(--nav-hover-color);
        }
        
        nav a.active {
            color: var(--nav-hover-color);
            font-weight: 500;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        h3 {
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }
        
        p {
            margin-bottom: 1.2rem;
            font-size: 1.1rem;
        }
        
        a {
            color: var(--link-color);
            text-decoration: none;
            transition: opacity 0.2s ease;
        }
        
        a:hover {
            opacity: 0.8;
        }
        
        .external-link::after {
            content: "↗";
            display: inline-block;
            margin-left: 3px;
        }
        
        ol, ul {
            padding-left: 2rem;
        }
        
        li {
            margin-bottom: 1.5rem;
        }
        
        /* Compact papers list */
        .papers-list {
            list-style: none;
            padding-left: 0;
            margin: 0.6rem 0 0 0;
        }

        .papers-list li {
            margin: 0.35rem 0;
        }

        .papers-list .title {
            font-size: 1.05rem;
            font-weight: 500;
        }

        .papers-list .meta {
            color: #666;
        }

        [data-theme="dark"] .papers-list .meta {
            color: #aaa;
        }

        .paper-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.3rem;
        }
        
        .paper-authors {
            margin-bottom: 0.3rem;
        }
        
        .paper-journal {
            font-style: italic;
            margin-bottom: 0.5rem;
            color: #666;
        }
        
        [data-theme="dark"] .paper-journal {
            color: #aaa;
        }
        
        .download-link {
            display: inline-block;
            margin-top: 0.3rem;
        }
        
        .paper-description {
            color: #666;
            font-size: 1rem;
            margin-top: 0.5rem;
            margin-left: 0.5rem;
        }
        
        [data-theme="dark"] .paper-description {
            color: #aaa;
        }
        
        /* Theme toggle styling */
        .theme-toggle-wrapper {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 28px;
            margin-left: 10px;
        }
        
        .theme-toggle {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #e0e0e0;
            transition: .4s;
            border-radius: 28px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        .theme-toggle:checked + .toggle-slider {
            background-color: #3a3a3a;
        }
        
        .theme-toggle:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .site-title {
            font-weight: 500;
            font-size: 1.1rem;
        }
        
        .resource-links {
            display: inline-block;
            margin-left: 0.5rem;
        }

        /* Papers map */
        .papers-map {
            margin-top: -10px;
            margin-bottom: 28px;
        }
        .papers-map svg {
            width: 100%;
            height: 160px;
            display: block;
        }
        .papers-map .subtitle {
            margin: 0 0 8px 0;
            font-size: 0.95rem;
            color: var(--nav-color);
        }
        .cluster-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px 14px;
            align-items: center;
            margin-top: 8px;
        }
        .cluster-legend .item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            color: var(--nav-color);
            cursor: default;
            user-select: none;
        }
        .cluster-legend .swatch {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 1px solid rgba(0,0,0,0.15);
        }
        [data-theme="dark"] .cluster-legend .swatch {
            border-color: rgba(255,255,255,0.15);
        }
        .papers-list li {
            transition: background-color 0.15s ease, border-color 0.15s ease;
        }
        .papers-list li.pulse {
            animation: pulse-border 1.2s ease 1;
        }
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(50, 50, 50, 0.0); }
            40% { box-shadow: 0 0 0 8px rgba(50, 50, 50, 0.08); }
            100% { box-shadow: 0 0 0 0 rgba(50, 50, 50, 0.0); }
        }
    </style>
</head>
<body>
    <header>
        <div class="site-title">
            <span>Max Kirkby</span>
        </div>
        <nav>
            <a href="index.html">me</a>
            <a href="research.html" class="active">research</a>
            <a href="#">writing</a>
            <label class="theme-toggle-wrapper">
                <input type="checkbox" class="theme-toggle">
                <span class="toggle-slider"></span>
            </label>
        </nav>
    </header>

    <main>       
        <section class="papers-map" aria-label="Papers similarity map">
            <div class="subtitle">Papers map (computed similarity)</div>
            <svg id="papers-map-svg" viewBox="0 0 800 160" preserveAspectRatio="xMidYMid meet" role="img" aria-label="Graph of paper similarities"></svg>
            <div class="cluster-legend" id="cluster-legend" aria-hidden="true" style="display:none"></div>
        </section>
        <section>
            <h2>Primary</h2>
            <ul class="papers-list">
                <li>
                    <a class="title" href="https://arxiv.org/abs/2507.23221">A Single Direction of Truth: An Observer Model's Linear Residual Probe Exposes and Steers Contextual Hallucinations
                    </a>
                     — O'Neill, Chalnev, Kirkby, Zhao and Jayasekara. <span class="meta">Actionable Interpretability Workshop, ICML (2025)</span>
                </li>
                <li>
                    <a class="title" href="https://www.cell.com/trends/biochemical-sciences/fulltext/S0968-0004(23)00165-2">Guanylate-binding proteins: mechanisms of pattern recognition and antimicrobial functions</a>
                     — Kirkby et al. <span class="meta">Trends in Biochemical Sciences (2023)</span>
                </li>
                <li>
                    <a class="title" href="https://www.cell.com/cell-host-microbe/fulltext/S1931-3128(22)00133-0">Streptococcus makes the cut: Gasdermin A-induced pyroptosis</a>
                     — Zhao, Kirkby and Man. <span class="meta">Cell Host & Microbe Immunology (2022)</span>
                </li>
                <li>
                    <a class="title" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/ceo.14023">Running to save sight: The effects of exercise on retinal health and function</a>
                     — Chu-Tan, Kirkby and Natoli. <span class="meta">Clinical & Experimental Ophthalmology (2021)</span>
                </li>
            </ul>
        </section>

        <section>
            <h2>Co-Authored</h2>
            <ul class="papers-list">
                <li>
                    <a class="title" href="https://www.biorxiv.org/content/10.1101/2024.09.15.613156v1.abstract">Exploring Differences in Functional Connectivity in Australian Rules Football Players : A Resting-State fMRI Study on the Default Mode Network
                    </a>
                     — Tran et al. <span class="meta">biorxiv (2024)</span>
                </li>

                <li>
                    <a class="title" href="https://pubmed.ncbi.nlm.nih.gov/39594256/#:~:text=Methods%3A%204DCarE%20(4D%2Dflow,(45%2D60%20min).">Four-Dimensional Flow MRI for Cardiovascular Evaluation (4DCarE): A Prospective Non-Inferiority Study of a Rapid Cardiac MRI Exam: Study Protocol and Pilot Analysis</a>
                     — Qin et al. <span class="meta">Diagnostics (2024)</span>
                </li>
                <li>
                    <a class="title" href="https://www.nature.com/articles/s41590-024-01988-6">Inflammasome protein scaffolds the DNA damage complex during tumor development</a>
                     — Shen et al. <span class="meta">Nature Immunology (2024)</span>
                </li>
                <li>
                    <a class="title" href="https://www.embopress.org/doi/full/10.15252/embj.2022112558">Immunity against Moraxella catarrhalis requires guanylate‐binding proteins and caspase‐11‐NLRP3 inflammasomes</a>
                     — Enosi-Tuipulotu et al. <span class="meta">EMBO Journal (2023)</span>
                </li>
                <li>
                    <a class="title" href="https://www.frontiersin.org/journals/physiology/articles/10.3389/fphys.2023.1116898/full">Voluntary exercise modulates pathways associated with amelioration of retinal degenerative diseases</a>
                     — Chu-Tan et al. <span class="meta">Frontiers in Physiology (2023)</span>
                </li>
                <li>
                    <a class="title" href="https://onlinelibrary.wiley.com/doi/abs/10.1111/imr.12906">Molecular mechanisms activating the NAIP‐NLRC4 inflammasome: implications in infectious disease, autoinflammation, and cancer</a>
                     — Kay et al. <span class="meta">Immunological Reviews (2020)</span>
                </li>
            </ul>
        </section>

        <section>
            <h2>Conference Proceedings</h2>
            <ul class="papers-list">
                <li>
                    <a class="title" href="https://rldm.org/">A spatial navigation paradigm for investigating hierarchical planning</a>
                     — Kirkby et al. <span class="meta">Reinforcement Learning and Decision Making (RLDM) (2025)</span>
                </li>
                <li>
                    <a class="title" href="https://symposium.mndassociation.org/wp-content/uploads/2023/11/LOW-RES-FOR-WEBSITE-FINAL.pdf">Multi-modal detection of changes in MND for the quantitative evaluation of response to 3K3A-APC treatment</a>
                     — Kirkby et al. <span class="meta">34th International Symposium on ALS/MND (2023)</span>
                </li>
            </ul>
        </section>

        <section>
            <h2>Blogs</h2>
            <ul class="papers-list">
            </ul>
        </section>
    </main>

    <script>
        const themeToggle = document.querySelector('.theme-toggle');
        
        function setTheme(isDark) {
            if (isDark) {
                document.body.setAttribute('data-theme', 'dark');
                themeToggle.checked = true;
            } else {
                document.body.removeAttribute('data-theme');
                themeToggle.checked = false;
            }
            localStorage.setItem('darkMode', isDark ? 'true' : 'false');
        }
        
        const savedDarkMode = localStorage.getItem('darkMode') === 'true';
        
        setTheme(savedDarkMode);
        
        themeToggle.addEventListener('change', () => {
            setTheme(themeToggle.checked);
        });

        // ---------- Papers similarity map ----------
        (function() {
            const svg = document.getElementById('papers-map-svg');
            if (!svg) return;

            // Collect papers from DOM
            const paperLinkSelector = '.papers-list li > a.title';
            const linkNodes = Array.from(document.querySelectorAll(paperLinkSelector));
            const papers = linkNodes.map((a, idx) => {
                const title = a.textContent.trim().replace(/\s+/g, ' ');
                return {
                    id: 'p' + idx,
                    title,
                    year: extractYearFromLi(a.closest('li')),
                    li: a.closest('li'),
                    a
                };
            });

            if (papers.length === 0) return;

            // Build TF-IDF vectors from titles
            const tokensList = papers.map(p => tokenize(p.title));
            const df = new Map();
            tokensList.forEach(tokens => {
                const unique = new Set(tokens);
                unique.forEach(t => df.set(t, (df.get(t) || 0) + 1));
            });
            const N = papers.length;
            const idf = new Map();
            df.forEach((docFreq, term) => {
                idf.set(term, Math.log((N + 1) / (docFreq + 1)) + 1);
            });
            const vectors = tokensList.map(tokens => {
                const tf = new Map();
                tokens.forEach(t => tf.set(t, (tf.get(t) || 0) + 1));
                // log-scaled tf
                tf.forEach((count, term) => tf.set(term, 1 + Math.log(count)));
                // build sparse vector
                const v = new Map();
                tf.forEach((tfVal, term) => {
                    const idfVal = idf.get(term) || 0;
                    v.set(term, tfVal * idfVal);
                });
                return v;
            });

            function dot(a, b) {
                let s = 0;
                if (a.size < b.size) {
                    a.forEach((va, k) => { const vb = b.get(k); if (vb) s += va * vb; });
                } else {
                    b.forEach((vb, k) => { const va = a.get(k); if (va) s += va * vb; });
                }
                return s;
            }
            function norm(a) {
                let s = 0; a.forEach(v => s += v * v); return Math.sqrt(s) || 1;
            }
            const norms = vectors.map(norm);

            // Build kNN similarity graph (k=3 by default, capped by N-1)
            const k = Math.max(1, Math.min(3, N - 1));
            const edges = [];
            const edgeSet = new Set();
            for (let i = 0; i < N; i++) {
                const sims = [];
                for (let j = 0; j < N; j++) if (i !== j) {
                    const s = dot(vectors[i], vectors[j]) / (norms[i] * norms[j]);
                    sims.push({ j, s });
                }
                sims.sort((a, b) => b.s - a.s);
                for (let t = 0; t < Math.min(k, sims.length); t++) {
                    const j = sims[t].j;
                    const key = i < j ? `${i}-${j}` : `${j}-${i}`;
                    if (edgeSet.has(key)) continue;
                    edgeSet.add(key);
                    edges.push({ source: i, target: j, weight: Math.max(0, sims[t].s) });
                }
            }

            // Simple force-directed layout (Fruchterman-Reingold style, few iters for speed)
            const width = 800, height = 160;
            const nodes = papers.map((p, i) => ({
                idx: i,
                id: p.id,
                x: (i + 0.5) * (width / N) + (Math.random() - 0.5) * 20,
                y: height / 2 + (Math.random() - 0.5) * 20,
                vx: 0, vy: 0
            }));
            const idealLen = 60;
            const repulse = 1200;
            const damping = 0.85;
            for (let iter = 0; iter < 100; iter++) {
                // repulsion
                for (let i = 0; i < N; i++) {
                    for (let j = i + 1; j < N; j++) {
                        let dx = nodes[i].x - nodes[j].x;
                        let dy = nodes[i].y - nodes[j].y;
                        let dist2 = dx*dx + dy*dy + 0.01;
                        let f = repulse / dist2;
                        let invDist = 1 / Math.sqrt(dist2);
                        dx *= invDist; dy *= invDist;
                        nodes[i].vx += dx * f; nodes[i].vy += dy * f;
                        nodes[j].vx -= dx * f; nodes[j].vy -= dy * f;
                    }
                }
                // attraction along edges
                edges.forEach(e => {
                    const a = nodes[e.source], b = nodes[e.target];
                    let dx = b.x - a.x; let dy = b.y - a.y;
                    const dist = Math.sqrt(dx*dx + dy*dy) || 0.001;
                    const desired = idealLen * (1 - e.weight * 0.4);
                    const kspring = 0.01;
                    const f = kspring * (dist - desired);
                    dx /= dist; dy /= dist;
                    a.vx += dx * f; a.vy += dy * f;
                    b.vx -= dx * f; b.vy -= dy * f;
                });
                // integrate
                for (let i = 0; i < N; i++) {
                    nodes[i].x += nodes[i].vx;
                    nodes[i].y += nodes[i].vy;
                    nodes[i].vx *= damping;
                    nodes[i].vy *= damping;
                    // bounds
                    nodes[i].x = Math.max(10, Math.min(width - 10, nodes[i].x));
                    nodes[i].y = Math.max(10, Math.min(height - 10, nodes[i].y));
                }
            }

            // Build weighted adjacency for label propagation clustering
            const neighbors = Array.from({ length: N }, () => new Map());
            edges.forEach(e => {
                neighbors[e.source].set(e.target, (neighbors[e.source].get(e.target) || 0) + e.weight);
                neighbors[e.target].set(e.source, (neighbors[e.target].get(e.source) || 0) + e.weight);
            });
            // initialize labels as own index
            const labels = Array.from({ length: N }, (_, i) => i);
            for (let it = 0; it < 20; it++) {
                let changed = 0;
                // update order shuffled each iteration to reduce bias
                const order = Array.from({ length: N }, (_, i) => i);
                for (let i = N - 1; i > 0; i--) {
                    const r = Math.floor(Math.random() * (i + 1));
                    const tmp = order[i]; order[i] = order[r]; order[r] = tmp;
                }
                for (let oi = 0; oi < N; oi++) {
                    const i = order[oi];
                    const counts = new Map();
                    neighbors[i].forEach((w, j) => {
                        const lab = labels[j];
                        counts.set(lab, (counts.get(lab) || 0) + w);
                    });
                    if (counts.size === 0) continue;
                    let bestLab = labels[i], bestCnt = -1;
                    counts.forEach((cnt, lab) => { if (cnt > bestCnt) { bestCnt = cnt; bestLab = lab; } });
                    if (bestLab !== labels[i]) { labels[i] = bestLab; changed++; }
                }
                if (!changed) break;
            }
            // relabel contiguous integers and cap to 8 colors
            const labelMap = new Map();
            let next = 0;
            labels.forEach(l => { if (!labelMap.has(l)) labelMap.set(l, next++); });
            const clusterIds = labels.map(l => labelMap.get(l));
            const numClusters = Math.min(8, Math.max(...clusterIds) + 1);

            // Color scale from CSS vars
            const clusterColor = c => getComputedStyle(document.documentElement).getPropertyValue(`--cluster-${(c % 8) + 1}`).trim() || 'rgb(32, 94, 166)';

            // Render SVG
            while (svg.firstChild) svg.removeChild(svg.firstChild);
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            // Draw edges
            const edgeGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            edgeGroup.setAttribute('fill', 'none');
            edgeGroup.setAttribute('stroke', 'currentColor');
            edgeGroup.setAttribute('stroke-opacity', '0.25');
            edgeGroup.setAttribute('stroke-width', '1');
            edges.forEach(e => {
                const a = nodes[e.source], b = nodes[e.target];
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', a.x.toFixed(1));
                line.setAttribute('y1', a.y.toFixed(1));
                line.setAttribute('x2', b.x.toFixed(1));
                line.setAttribute('y2', b.y.toFixed(1));
                edgeGroup.appendChild(line);
            });
            svg.appendChild(edgeGroup);

            // Draw nodes
            const nodeGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            nodes.forEach((n, i) => {
                const c = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                c.setAttribute('cx', n.x.toFixed(1));
                c.setAttribute('cy', n.y.toFixed(1));
                c.setAttribute('r', '5');
                c.setAttribute('fill', clusterColor(clusterIds[i]));
                c.setAttribute('fill-opacity', '0.8');
                c.setAttribute('stroke', 'currentColor');
                c.setAttribute('stroke-opacity', '0.25');
                c.dataset.paperId = papers[i].id;
                c.dataset.cluster = String(clusterIds[i]);
                // Accessible tooltip via <title>
                const t = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                t.textContent = papers[i].title;
                c.appendChild(t);
                nodeGroup.appendChild(c);
            });
            svg.appendChild(nodeGroup);

            // Legend (optional; hidden by default but kept for debugging)
            const legend = document.getElementById('cluster-legend');
            if (legend) {
                legend.innerHTML = '';
                for (let c = 0; c < numClusters; c++) {
                    const item = document.createElement('span');
                    item.className = 'item';
                    const sw = document.createElement('span');
                    sw.className = 'swatch';
                    sw.style.backgroundColor = clusterColor(c);
                    const label = document.createElement('span');
                    label.textContent = `Cluster ${c+1}`;
                    item.appendChild(sw); item.appendChild(label);
                    legend.appendChild(item);
                }
            }

            // DOM mapping for interactions
            const idToCircle = new Map(Array.from(nodeGroup.querySelectorAll('circle')).map(c => [c.dataset.paperId, c]));
            papers.forEach((p, i) => {
                p.li.dataset.paperId = p.id;
                p.li.dataset.cluster = String(clusterIds[i]);
            });

            function highlightCluster(cluster, on) {
                const color = clusterColor(cluster);
                const alphaBg = document.body.getAttribute('data-theme') === 'dark' ? 0.15 : 0.12;
                const bg = toRgba(color, alphaBg);
                papers.forEach(p => {
                    if (p.li.dataset.cluster === String(cluster)) {
                        p.li.style.backgroundColor = on ? bg : '';
                        p.li.style.borderLeft = on ? `3px solid ${color}` : '';
                    }
                });
                nodeGroup.querySelectorAll('circle').forEach(c => {
                    if (c.dataset.cluster === String(cluster)) {
                        c.setAttribute('fill-opacity', on ? '1' : '0.8');
                        c.setAttribute('r', on ? '6' : '5');
                    } else if (on) {
                        c.setAttribute('fill-opacity', '0.25');
                    } else {
                        c.setAttribute('fill-opacity', '0.8');
                        c.setAttribute('r', '5');
                    }
                });
            }

            function highlightPaper(paperId, on) {
                const c = idToCircle.get(paperId);
                if (c) {
                    c.setAttribute('stroke-opacity', on ? '0.8' : '0.25');
                    c.setAttribute('stroke-width', on ? '2' : '1');
                }
            }

            // Hover interactions from SVG cluster circles
            nodeGroup.addEventListener('pointerover', e => {
                const target = e.target;
                if (target && target.tagName === 'circle') {
                    highlightCluster(target.dataset.cluster, true);
                }
            });
            nodeGroup.addEventListener('pointerout', e => {
                const target = e.target;
                if (target && target.tagName === 'circle') {
                    highlightCluster(target.dataset.cluster, false);
                }
            });
            nodeGroup.addEventListener('click', e => {
                const target = e.target;
                if (target && target.tagName === 'circle') {
                    const pid = target.dataset.paperId;
                    const li = document.querySelector(`li[data-paper-id="${pid}"]`);
                    if (li) {
                        li.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        li.classList.add('pulse');
                        setTimeout(() => li.classList.remove('pulse'), 1200);
                    }
                }
            });

            // Hover interactions from list to circle
            papers.forEach(p => {
                p.li.addEventListener('pointerover', () => highlightPaper(p.id, true));
                p.li.addEventListener('pointerout', () => highlightPaper(p.id, false));
            });

            // Utilities
            function extractYearFromLi(li) {
                if (!li) return null;
                const text = li.textContent || '';
                const m = text.match(/(20\d{2}|19\d{2})/);
                return m ? parseInt(m[1], 10) : null;
            }
            function tokenize(text) {
                const stop = new Set([
                    'the','and','of','in','on','for','a','an','to','with','by','from','at','as','is','are','be','or','vs','vs.','using','via','based','over','into','across','through','study','analysis','effect','effects','function','functions','model','models'
                ]);
                return text
                    .toLowerCase()
                    .replace(/[^a-z0-9\s]/g, ' ')
                    .split(/\s+/)
                    .filter(t => t.length > 1 && !stop.has(t));
            }
            function toRgba(rgb, alpha) {
                const m = rgb.match(/rgb\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\)/);
                if (!m) return rgb;
                return `rgba(${m[1]}, ${m[2]}, ${m[3]}, ${alpha})`;
            }
        })();
    </script>
</body>
</html>
